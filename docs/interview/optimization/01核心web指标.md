# 核心 Web 指标

[[TOC]]

::: tip 要点速览

- 三大核心：LCP（加载体验）、CLS（视觉稳定性）、INP（交互全程流畅）。
- 推荐阈值：LCP ≤ 2.5s、CLS ≤ 0.1、INP ≤ 200ms。
- 数据来源：实验室（Lighthouse 报告）与现场（Web Vitals 真实用户数据）。
- 落地路径：度量 → 归因 → 优化（图片/资源/渲染/交互）→ 复测闭环。
  :::

## 一、核心 Web 指标概述

在前端面试中，“如何进行网页性能优化”“用什么指标衡量优化效果”是高频问题。Google 提出的**核心 Web 指标**是当前业界最权威的性能量化标准，从**加载速度、视觉稳定性、交互响应性**三个维度描述用户体验，是性能优化的重要参考依据。优化网页性能需先量化成果，核心 Web 指标正是实现这一目标的关键工具。

## 二、三大核心指标详解

### （一）最大内容绘制（LCP）

1. **定义**：衡量用户打开页面后，最核心、最想看到的内容（如头条新闻标题、电商网站商品主图）的显示时间，直接反映用户感知到的加载速度。
2. **优秀标准**：控制在 2.5 秒以内。

::: tip LCP 优化建议

- 关键资源预加载：`<link rel="preload" as="image" href="hero.jpg" />`。
- 减少阻塞渲染：避免在首屏引入大体积同步脚本，使用 `defer`/`async`。
- 图片策略：使用合适格式（WebP/AVIF）、响应式图片 `srcset`、占位骨架。
- SSR/CSR 协作：通过服务器渲染首屏结构，减少首屏渲染时间。
  :::

### （二）累积布局偏移（CLS）

1. **定义**：量化页面抖动的严重程度，常见场景如点击链接时页面突然抖动导致点到其他位置，该指标可有效评估页面视觉稳定性。
2. **优秀标准**：分数低于 0.1，代表页面视觉稳定性极佳。

::: tip CLS 优化建议

- 固定媒体与广告位尺寸，避免加载后突变尺寸。
- 延迟加载内容预留空间或使用占位骨架。
- 避免在首屏插入动态内容；必要时使用过渡并预留高度。
- 字体加载策略：`font-display: swap`，避免 FOIT/闪烁。
  :::

### （三）交互到下一次绘制（INP）

1. **定义**：衡量从用户点击输入开始，到页面给出视觉反馈为止所花费的时间。与仅关注用户第一次交互延迟（FID，侧重“第一印象”）不同，INP 关注用户整个访问过程中的所有交互，且取其中最慢一次作为代表，更能反映页面全程的持久交互体验，尤其适用于复杂单页应用场景。
2. **优秀标准**：低于 200 毫秒。
3. **关键转变**：从 FID 到 INP 的转变，体现出性能衡量标准从“初始流畅”向“全程流畅”的升级，更贴合真实复杂的用户交互场景。

::: tip INP 优化建议

- 主线程负载优化：将重计算/大循环移至 Web Worker。
- 事件处理降本：`passive` 监听、节流/防抖、分批次更新。
- 渲染分块：避免长时间同步 DOM 更新，使用微任务/宏任务切片。
- 避免布局抖动：减少 `offset*` 强制回流查询，合并读写操作。
  :::

## 三、核心 Web 指标数据获取方式

| 数据类型   | 适用场景                   | 获取工具/方法                        | 特点                                                                     |
| ---------- | -------------------------- | ------------------------------------ | ------------------------------------------------------------------------ |
| 实验室数据 | 开发调试环境下的测试       | Chrome Dev Tool 中的 Lighthouse 工具 | 操作简单，生成报告后可清晰查看 LCP、CLS 等指标，同时能获取针对性优化建议 |
| 现场数据   | 线上监控，收集真实用户数据 | Google 官方库 Web Vitals             | 需通过编码方式引入，可收集真实用户的性能数据，便于后续精细归因和优化     |

::: info 快速上手：在项目中集成 Web Vitals
安装并在入口文件上报核心指标到你的监控端点：

```bash
npm i web-vitals
```

```js
// src/vitals.js
import { onLCP, onINP, onCLS } from "web-vitals";

function sendToAnalytics(metric) {
  // 上报到你的监控服务
  fetch("/analytics", {
    method: "POST",
    keepalive: true,
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      name: metric.name,
      value: metric.value,
      rating: metric.rating, // good / needs-improvement / poor
      id: metric.id,
    }),
  });
}

onLCP(sendToAnalytics);
onCLS(sendToAnalytics);
onINP(sendToAnalytics);
```

在单页应用中，记得在路由切换后重新订阅或按页面维度做聚合归因。
:::

---

## 四、前端面试回答建议（性能优化相关问题）

1. **阐述标准定义**：说明对 Core Web Vitals（核心 Web 指标）的理解，分别介绍 LCP（保障加载体验）、CLS（保障视觉稳定性）、INP（保障全程交互流畅性）的作用与意义。
2. **说明测量方法**：区分实验室数据和现场数据两种场景，分别对应 Lighthouse 工具（调试用）和 Web Vitals 库（线上真实用户监控用），体现对数据获取的全面认知。
3. **给出优化方案**：结合前面提到的指标数据，针对性说明优化策略，例如“为优化 LCP，可采取图片压缩、资源预加载等措施；为降低 CLS，需固定元素尺寸、避免动态插入内容等”，让回答更具实操性和说服力。

::: warning 常见误区

- 只跑一次 Lighthouse 报告就断言性能结论，忽视真实用户场景差异。
- 混淆 FID 与 INP，将“首次交互延迟”当成“全程交互体验”。
- 仅做总量优化（压缩体积），忽视关键路径与资源优先级（preload、preconnect）。
- 没有归因：拿到指标后不做瀑布图分析与 CPU/内存分析，难以定位瓶颈。
  :::

## 小结与后续

1. 指标只是起点：度量 → 归因 → 优化 → 复测闭环，才能形成持续提升。
2. 面向用户体验：首屏可见（LCP）、视觉稳定（CLS）、交互持续流畅（INP）。
3. 工具协作：Lighthouse 做实验室报告；Web Vitals 收集线上真实数据；结合瀑布图与性能面板定位问题。
4. 后续建议：引入 RUM（真实用户监控），建立阈值告警、看板与回归检查机制。
