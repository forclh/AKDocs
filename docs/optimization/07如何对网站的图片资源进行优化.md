# 如何对网站的图片资源进行优化

[[TOC]]

::: tip 要点速览

- 格式优先级：AVIF（极致体积）→ WebP（主流平衡）→ JPG（兜底）；图标/Logo 用 SVG。
- 响应式图片：`srcset + sizes` 按设备与展示尺寸选最合适资源，避免过载；保留宽高或 `aspect-ratio` 防 CLS。
- 懒加载：首屏优先、非视口用 `loading="lazy"` 或 IntersectionObserver 自定义占位与动画。
- 分发链路：图片上 CDN 并用“动态处理（裁剪/转码/压缩）”，前端仅传参，工程化效率最高。
- 验证指标：关注 LCP/CLS/总字节数与命中率；DevTools 的 Network 与 Lighthouse 联合验证。
  :::

## 快速上手

最小改动让图片“兼容 + 响应式 + 懒加载 + 防抖动”一次到位：

```html
<!-- 兼容格式降级：AVIF → WebP → JPG -->
<picture>
  <source srcset="/img/hero.avif" type="image/avif" />
  <source srcset="/img/hero.webp" type="image/webp" />
  <img
    src="/img/hero.jpg"
    alt="主页大图"
    width="1200"
    height="800"
    sizes="(max-width: 600px) 480px, (max-width: 1000px) 768px, 1200px"
    srcset="
      /img/hero-480.jpg   480w,
      /img/hero-768.jpg   768w,
      /img/hero-1200.jpg 1200w
    "
    loading="lazy"
    decoding="async"
  />
</picture>

<!-- SVG 图标（矢量、可用 CSS 改色/大小） -->
<svg width="24" height="24" viewBox="0 0 24 24" aria-hidden="true">
  <path fill="currentColor" d="M3 12h18v2H3z" />
  <path fill="currentColor" d="M11 3h2v18h-2z" />
</svg>

<!-- 进阶懒加载：自定义占位与进入视口后替换真实图 -->
<img
  id="card1"
  data-src="/img/card-1200.jpg"
  alt="卡片图"
  width="600"
  height="400"
/>
<script>
  const io = new IntersectionObserver((entries) => {
    entries.forEach((e) => {
      if (e.isIntersecting) {
        const img = e.target;
        img.src = img.dataset.src;
        io.unobserve(img);
      }
    });
  });
  io.observe(document.getElementById("card1"));
</script>

<!-- CDN 动态处理（示意）：只存原图，URL 参数裁剪/转码/压缩 -->
<img
  src="https://cdn.example.com/image/hero.jpg?width=768&format=webp&quality=70"
  alt="CDN 动态处理示例"
/>
```

::: warning 正确心智模型

- 优化不是“只压缩与懒加载”：应从“源头格式/内容 → 加载策略 → 分发链路”三层协同。
- 响应式图片的核心是“展示尺寸推导”，`sizes` 与 `srcset` 的配合决定最终加载体积。
- 防 CLS（布局抖动）：明确图片尺寸或使用 CSS `aspect-ratio`；避免图片加载后撑开布局。
  :::

## 核心问题引入（面试场景）

面试官典型提问：  
**“项目中有很多图片加载很慢，你有什么优化思路？”**

视频关键提醒：

- 若回答仅停留在“图片压缩”“懒加载”，会显得专业度不足；
- 优秀回答需具备**分层逻辑**，体现对图片优化全链路的思考，核心从“资源选择 → 加载策略 → 分发链路”三个维度展开。

## 核心优化维度（全链路方案）

### 维度 1：资源选择——从源头降低成本

核心原则：在图片生成/上传阶段，就选择“体积小、适配性强”的资源，避免后续优化被动。  
分为“格式选择”和“内容选择”两个层面：

#### 格式选择：兼顾压缩率与兼容性

| 图片格式 | 适用场景                             | 优势                                        | 注意事项                         |
| -------- | ------------------------------------ | ------------------------------------------- | -------------------------------- |
| WebP     | 2025 年现代浏览器（主流场景）        | 压缩率与兼容性平衡好，体积比 JPG 小 25%-35% | 无明显短板，优先推荐             |
| AVIF     | 追求“极致压缩率”的场景（如高清大图） | 压缩比优于 WebP，体积更小                   | 部分旧浏览器不兼容，需做回退     |
| JPG      | 兼容性兜底（老旧浏览器/设备）        | 所有浏览器支持，通用性强                    | 压缩率低，体积大，作为“最后选项” |

**优雅兼容方案：用`<picture>`标签实现自动降级**  
浏览器会自上而下检查格式支持度，匹配则加载对应资源，示例逻辑：

```html
<picture>
  <!-- 1. 优先加载AVIF（极致压缩） -->
  <source srcset="image.avif" type="image/avif" />
  <!-- 2. 不支持AVIF则加载WebP（平衡方案） -->
  <source srcset="image.webp" type="image/webp" />
  <!-- 3. 都不支持则加载JPG（兜底） -->
  <img src="image.jpg" alt="示例图片" />
</picture>
```

#### 内容选择：按图形类型匹配格式

- **非写实图形（logo、图标、简单插画）**：强制用**SVG 格式**  
  核心优势：
  1. 矢量图特性：无限缩放不失真（适配手机/PC/大屏）；
  2. 体积极小：比同等像素的位图小 50%以上；
  3. 可定制性强：直接通过 CSS 修改颜色、大小（无需多版本图标）。
- **写实图形（照片、复杂插画）**：用 WebP/AVIF（避免 SVG 体积膨胀）。

### 维度 2：加载策略——在“正确的时间”加载“正确的内容”

核心原则：**按需加载，避免浪费**（不加载用户看不到、用不上的资源），核心手段是“响应式图片”和“懒加载”。

#### 响应式图片：适配不同设备尺寸

- 痛点：手机加载 PC 端 4K 大图，会浪费用户流量（尤其移动端）、拖慢加载速度；
- 解决方案：用`<img>`标签的`srcset`和`size`属性，让浏览器自动选择合适尺寸的图片；
- 属性作用：
  - `srcset`：提供“不同尺寸的图片清单”（如小图、中图、大图）；
  - `size`：告诉浏览器“不同视口宽度下，图片的显示尺寸”；
- 示例逻辑：
  ```html
  <img
    srcset="image-small.jpg 480w,  <!-- 小图：480像素宽 -->
            image-medium.jpg 768w, <!-- 中图：768像素宽 -->
            image-large.jpg 1200w"
    <!--
    大图：1200像素宽
    --
  />
  sizes="(max-width: 600px) 480px,
  <!-- 视口≤600px：图片显示480px宽 -->
  (max-width: 900px) 768px,
  <!-- 视口≤900px：图片显示768px宽 -->
  1200px"
  <!-- 视口>900px：图片显示1200px宽 -->
  src="image-medium.jpg" alt="响应式图片示例" >
  ```
- 核心价值：浏览器结合“设备视口”和“图片显示尺寸”，自动加载“刚好够用”的图片，无冗余。

#### 懒加载：延迟加载“非视口内”图片

- 核心目标：提升首屏加载速度（优先加载用户当前能看到的内容）。
- 两种实现方案：

| 方案                      | 实现方式                                   | 优势                               | 适用场景                            |
| ------------------------- | ------------------------------------------ | ---------------------------------- | ----------------------------------- |
| 原生懒加载                | 给`<img>`标签加`loading="lazy"`属性        | 一行代码实现，无需额外 JS，性能好  | 无需精细化控制的场景（如列表图片）  |
| Intersection Observer API | 用 JS 监听图片是否进入“视口”，进入后再加载 | 可自定义占位符、加载动画、加载时机 | 需精细化控制的场景（如首页 Banner） |

- 原生方案示例：
  ```html
  <img src="image.jpg" alt="懒加载图片" loading="lazy" />
  ```

### 维度 3：分发链路——从架构层面提升效率

核心原则：**让专业的工具做专业的事**，突破“前端代码优化”的局限，从资源分发环节降延迟。

#### 核心手段：图片资源上 CDN

- 基础价值：CDN 通过“全球边缘节点”，让用户从“物理距离最近”的节点获取图片，大幅降低网络延迟（尤其跨国/跨地区访问）。
- 进阶价值：现代 CDN 的“动态图片处理能力”（关键亮点）：
  1. 只需上传 1 张“最高清原图”到 CDN；
  2. 请求图片时，通过**URL 参数**动态实现：
     - 尺寸调整（如`?width=400`返回 400px 宽的图）；
     - 格式转化（如自动转为 WebP/AVIF）；
     - 附加操作（加水印、裁剪、灰度处理）；
  3. 核心优势：剥离业务代码中的图片处理逻辑，前端无需维护“多尺寸/多格式图片”，只需请求“所需参数”即可，工程化效率极大提升。

#### 传统方案：CSS 雪碧图（Sprite）

- 原理：将多个小图（如图标）合并成 1 张大图，通过 CSS`background-position`显示单个图标，减少 HTTP 请求数。
- 现状：
  - HTTP1.1 时代：关键优化（因浏览器对同域名并发请求数有限制）；
  - HTTP2 多路复用普及后：必要性下降（可并行请求多个小图，无需合并）；
  - 残留价值：特定场景（如加载大量小图标，需进一步减少请求数）仍可用。

## 面试答题高分模板（结构化总结）

面对“图片加载慢如何优化”的问题，可按以下逻辑回答，体现专业深度：

1. **资源选择层**：
   - 优先用 WebP 格式（平衡压缩率与兼容性），用`<picture>`标签做 AVIF→WebP→JPG 的优雅降级；
   - logo/图标用 SVG（无限缩放、体积小、可 CSS 定制）。
2. **加载策略层**：
   - 用`srcset+size`实现响应式图片，避免设备适配浪费；
   - 非首屏图片开启`loading="lazy"`原生懒加载，需精细化控制时用 Intersection Observer API。
3. **分发链路层**：
   - 将图片部署到 CDN，利用边缘节点降延迟；
   - 结合 CDN 的动态图片处理能力，简化前端图片管理，实现自动化优化。

## 关键知识点提炼

| 类别     | 核心内容                                                                                     |
| -------- | -------------------------------------------------------------------------------------------- |
| 核心技术 | WebP/AVIF 格式、`<picture>`标签、SVG、`srcset/size`、Intersection Observer API、CDN 动态处理 |
| 核心思想 | 源头优化（资源选择）→ 过程优化（加载策略）→ 架构优化（分发链路）                             |
| 高频考点 | `<picture>`标签降级逻辑、SVG 优势、CDN 动态图片处理、懒加载实现方案                          |
| 避坑点   | 不要仅依赖“压缩/懒加载”；HTTP2 下无需过度依赖 CSS 雪碧图                                     |

## 实践建议

::: danger 常见误区与避坑

- 用 PNG/JPG 处理照片类图片：忽视 WebP/AVIF 带来的体积优势与画质可接受范围。
- 错写 `sizes` 或不写：浏览器误判展示尺寸，加载过大的图片导致浪费与卡顿。
- 未设定尺寸/比例：图片加载后改变布局造成 CLS；应使用 `width/height` 或 `aspect-ratio`。
- 过度依赖雪碧图：HTTP/2/3 场景下收益有限；优先使用独立资源与现代压缩。
- 前端冗余维护多尺寸：应交给 CDN 动态处理，减少构建产物与发布复杂度。
  :::

---

## 小结与后续

- 三层协同优化：源头（格式/内容）→ 过程（响应式/懒加载/防抖动）→ 分发（CDN 动态处理）。
- 先用 `<picture>` 做优雅降级，再用 `srcset + sizes` 精准匹配设备；非首屏图统一懒加载。
- 结合 DevTools 与 Lighthouse 验证 LCP/CLS/总字节数与网络命中率，持续调优规则与阈值。

视频强调：理论需落地，建议在项目中建立“图片优化全流程”：

1. 上传阶段：强制 SVG（图标）、WebP（写实图），用工具自动转格式；
2. 开发阶段：统一用`srcset+size`写响应式图片，非首屏图加懒加载；
3. 部署阶段：图片全量上 CDN，对接动态处理能力，减少前端维护成本；
4. 效果验证：通过 Lighthouse 等工具检测图片加载性能，持续迭代。
