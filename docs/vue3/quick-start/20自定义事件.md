# âœ¨ è‡ªå®šä¹‰äº‹ä»¶ ğŸ‘Œ

[[TOC]]

::: tip è¦ç‚¹é€Ÿè§ˆ

- å­ç»„ä»¶é€šè¿‡è‡ªå®šä¹‰äº‹ä»¶æŠŠæ•°æ®â€œå‘ä¸Šâ€ä¼ ç»™çˆ¶ç»„ä»¶ï¼Œé…åˆ Props å½¢æˆå•å‘æ•°æ®æµã€‚
- åœ¨ `<script setup>` ä¸­ç”¨ `defineEmits()` å£°æ˜äº‹ä»¶ï¼›åœ¨æ¨¡æ¿ä¸­ä¹Ÿå¯ç›´æ¥ä½¿ç”¨ `$emit`ã€‚
- äº‹ä»¶ååœ¨æ¨¡æ¿ä¸­æ¨èä½¿ç”¨çŸ­æ¨ªçº¿ï¼š`@update-rating`ã€`@submit`ï¼›å¤§å°å†™ä¸æ•æ„Ÿä½†å»ºè®®ç»Ÿä¸€ã€‚
- äº‹ä»¶å¯æ ¡éªŒ payloadï¼ˆ`defineEmits({ event: validator })`ï¼‰ï¼Œä¾¿äºåœ¨å¼€å‘é˜¶æ®µå‘ç°é—®é¢˜ã€‚
- ä¸ `v-model` çš„çº¦å®šï¼šæ¥æ”¶ `modelValue`ï¼Œè§¦å‘ `update:modelValue`ï¼›æ”¯æŒå¤š `v-model`ã€‚
- çˆ¶çº§ç›‘å¬å¯ç”¨ `.once` ä¿®é¥°ç¬¦ï¼›å…¶ä»–ä¿®é¥°ç¬¦å¤šç”¨äº DOM äº‹ä»¶ï¼Œä¸é€‚ç”¨äºç»„ä»¶äº‹ä»¶ã€‚
  :::

## å¿«é€Ÿä¸Šæ‰‹

ä»¥è¯„åˆ†ç»„ä»¶ä¸ºä¾‹ï¼Œå­ç»„ä»¶è§¦å‘ `update-rating` å°†æœ€æ–°åˆ†å€¼ä¼ é€’ç»™çˆ¶ç»„ä»¶ï¼š

```vue :collapsed-lines
<template>
  <div class="rating-container">
    <span v-for="star in 5" :key="star" class="star" @click="setStar(star)">
      {{ rating >= star ? "â˜…" : "â˜†" }}
    </span>
  </div>
</template>

<script setup>
import { ref } from "vue";

const rating = ref(0);
const emit = defineEmits(["update-rating"]);

function setStar(newStar) {
  rating.value = newStar;
  emit("update-rating", rating.value);
}
</script>

<style scoped>
.rating-container {
  display: flex;
  font-size: 24px;
  cursor: pointer;
}
.star {
  margin-right: 5px;
  color: gold;
}
.star:hover {
  color: orange;
}
</style>
```

çˆ¶ç»„ä»¶ç›‘å¬å¹¶æ¥æ”¶å­ç»„ä»¶ä¼ å›çš„åˆ†å€¼ï¼š

```vue :collapsed-lines
<template>
  <div class="app-container">
    <h1>è¯·å¯¹æœ¬æ¬¡æœåŠ¡è¯„åˆ†ï¼š</h1>
    <Rating @update-rating="handleRating" />
    <p v-if="rating > 0">ä½ å½“å‰çš„è¯„ä»·ä¸º {{ rating }} é¢—æ˜Ÿ</p>
  </div>
</template>

<script setup>
import { ref } from "vue";
import Rating from "./components/Rating.vue";

const rating = ref(0);
function handleRating(newRating) {
  rating.value = newRating;
}
</script>

<style scoped>
.app-container {
  max-width: 600px;
  margin: auto;
  text-align: center;
  font-family: Arial, sans-serif;
}
p {
  font-size: 18px;
  color: #333;
}
</style>
```

::: warning äº‹ä»¶å‘½å

- æ¨èçŸ­æ¨ªçº¿å‘½åï¼Œé¿å…ä¸å˜é‡åäº§ç”Ÿæ­§ä¹‰ï¼š`update-rating`ã€`form-submit`ã€‚
- çˆ¶æ¨¡æ¿ç›‘å¬æ—¶ä¿æŒä¸€è‡´çš„å‘½åï¼›ä¸å»ºè®®åœ¨äº‹ä»¶åä¸­ä½¿ç”¨ç©ºæ ¼æˆ–ç‰¹æ®Šå­—ç¬¦ã€‚
  :::

## æ¨¡æ¿ä¸­ç›´æ¥è§¦å‘äº‹ä»¶

åœ¨æ¨¡æ¿ä¸­æ— éœ€æ˜¾å¼å£°æ˜å³å¯ä½¿ç”¨ `$emit`ï¼š

```vue
<span
  v-for="star in 5"
  :key="star"
  class="star"
  @click="$emit('update-rating', star)"
>
  {{ rating >= star ? 'â˜…' : 'â˜†' }}
</span>
```

::: tip ä½•æ—¶é€‰æ‹© `$emit`

- ç®€å•åœºæ™¯ã€ä»…åœ¨æ¨¡æ¿ä¸­è§¦å‘æ—¶ä½¿ç”¨ `$emit` æ›´ç›´æ¥ã€‚
- è‹¥åœ¨è„šæœ¬ä¸­å¤šå¤„è§¦å‘æˆ–éœ€è¦æ ¡éªŒï¼Œä½¿ç”¨ `defineEmits()` æ›´è§„èŒƒã€‚
  :::

## äº‹ä»¶æ ¡éªŒï¼ˆå¼€å‘æœŸï¼‰

ç±»ä¼¼ Props æ ¡éªŒï¼Œäº‹ä»¶ä¹Ÿå¯æ ¡éªŒ payloadï¼š

```vue
<script setup>
const emit = defineEmits({
  // æ— æ ¡éªŒ
  click: null,

  // å¯¹æäº¤äº‹ä»¶è¿›è¡Œæ ¡éªŒ
  submit: ({ email, password }) => {
    const ok = Boolean(email && password);
    if (!ok) console.warn("Invalid submit event payload!");
    return ok;
  },
});

function submitForm(email: string, password: string) {
  emit("submit", { email, password });
}
</script>
```

è¯„åˆ†ç»„ä»¶çš„æ ¡éªŒç¤ºä¾‹ï¼š

```vue
<script setup>
const emit = defineEmits({
  "update-rating": (value: number) => {
    if (value < 1 || value > 5) {
      console.warn("è¯„åˆ†å¿…é¡»åœ¨ 1~5 èŒƒå›´å†…");
      return false;
    }
    return true;
  },
});
</script>
```

::: danger å¸¸è§è¯¯åŒº

- äº‹ä»¶æ ¡éªŒå¤±è´¥ä¸ä¼šé˜»æ­¢çˆ¶ç»„ä»¶æ¥æ”¶å€¼ï¼ˆå¼€å‘æœŸä»…å‘Šè­¦ï¼‰ï¼Œä»éœ€åœ¨çˆ¶å±‚åšå¿…è¦çš„é˜²å¾¡æ€§å¤„ç†ã€‚
- äº‹ä»¶åä¸çˆ¶å±‚ç›‘å¬åä¸ä¸€è‡´ï¼ˆä¾‹å¦‚å¤§å°å†™å·®å¼‚ï¼‰å¯¼è‡´å›è°ƒæœªè§¦å‘ã€‚
  :::

## ä¸ Props çš„å…³ç³»ï¼ˆå•å‘æ•°æ®æµï¼‰

å­ç»„ä»¶ä¸åº”ç›´æ¥ä¿®æ”¹ä» Props æ¥æ”¶åˆ°çš„æ•°æ®ï¼Œéœ€é€šè¿‡äº‹ä»¶è¯·æ±‚çˆ¶ç»„ä»¶æ›´æ–°ï¼š

```js
// å­ç»„ä»¶
const props = defineProps({ count: Number });
const emit = defineEmits(["update:count"]);

function increment() {
  emit("update:count", props.count + 1);
}
```

çˆ¶ç»„ä»¶ç”¨å—æ§æ–¹å¼ç»´æŠ¤æ•°æ®ï¼š

```vue
<Counter :count="count" @update:count="count = $event" />
```

## é¢å¤–ç»†èŠ‚

::: warning ç»„ç»‡çº¦å®š

- å°† `defineEmits` ä¸è§¦å‘é€»è¾‘æ”¾åœ¨ä¸€èµ·ï¼Œä¾¿äºç»´æŠ¤ã€‚
- å¯¹å…¬å…±äº‹ä»¶ä¸ payload è¿›è¡Œç±»å‹æ–‡æ¡£åŒ–ï¼Œå‡å°‘ä¸Šä¸‹æ¸¸ä¸ä¸€è‡´ã€‚
  :::

## TypeScriptï¼ˆå¯é€‰ï¼‰

å¯¹ `defineEmits` æä¾›äº‹ä»¶ç­¾åï¼Œæ›´ç›´è§‚åœ°çº¦æŸè§¦å‘ä¸ç›‘å¬ï¼š

```ts
type Events = {
  (e: "update-rating", value: number): void;
  (e: "submit", payload: { email: string; password: string }): boolean;
};

const emit = defineEmits<Events>();

emit("update-rating", 5);
emit("submit", { email: "a@b.com", password: "***" });
```

## å°ç»“ä¸åç»­

è‡ªå®šä¹‰äº‹ä»¶æ˜¯å­ â†’ çˆ¶é€šä¿¡çš„å…³é”®ï¼Œä¸ Props å…±åŒæ„æˆå•å‘æ•°æ®æµã€‚æ¥ä¸‹æ¥å»ºè®®ç»§ç»­å­¦ä¹ ï¼š

1. æ’æ§½ï¼ˆç»“æ„ä¸å†…å®¹æ‰©å±•ï¼‰
2. ç»„åˆä½¿ç”¨ï¼šProps + äº‹ä»¶ + æ’æ§½æ„å»ºå¯å¤ç”¨çš„å¤æ‚ç»„ä»¶

::: tip å­¦ä¹ å»ºè®®

- å…ˆæŒæ¡äº‹ä»¶å£°æ˜ã€è§¦å‘ã€æ ¡éªŒä¸ `v-model` çº¦å®šã€‚
- ç„¶åç»“åˆ Propsã€æ’æ§½è¿›è¡Œç»„ä»¶çš„å—æ§è®¾è®¡ä¸æ‰©å±•ã€‚
  :::
